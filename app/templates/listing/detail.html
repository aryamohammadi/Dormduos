{% extends "base.html" %}

{% block title %}{{ listing.title }} | UCR HousingConnect{% endblock %}

{% block head %}
<style>
    .unit-option {
        transition: all 0.2s ease-in-out;
    }
    
    .unit-option:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
</style>
{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Listing Details -->
    <div class="lg:col-span-2 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md">
        <div class="flex justify-between items-start mb-4">
            <h1 class="text-2xl font-bold text-gray-900 dark:text-white">{{ listing.title }}</h1>
            <span class="text-2xl font-bold text-ucr-blue-600 dark:text-ucr-blue-400">
                {% if listing.is_multi_unit %}
                    Starting at ${{ "%.2f"|format(listing.price) }}
                {% else %}
                    ${{ "%.2f"|format(listing.price) }}
                {% endif %}
            </span>
        </div>
        
        <p class="text-gray-600 dark:text-gray-300 mb-4">{{ listing.address }}</p>
        
        <!-- Property Details -->
        <div class="flex flex-wrap gap-4 mb-6 text-sm">
            {% if listing.is_multi_unit %}
                <!-- Multi-unit property details -->
                <div class="bg-ucr-blue-100 dark:bg-ucr-blue-900 px-3 py-1 rounded-full text-ucr-blue-800 dark:text-ucr-blue-200">
                    {% if listing.min_bedrooms == listing.max_bedrooms %}
                        {{ listing.min_bedrooms }} {% if listing.min_bedrooms == 1 %}Bedroom{% else %}Bedrooms{% endif %}
                    {% else %}
                        {{ listing.min_bedrooms }}-{{ listing.max_bedrooms }} Bedrooms
                    {% endif %}
                </div>
                <div class="bg-ucr-blue-100 dark:bg-ucr-blue-900 px-3 py-1 rounded-full text-ucr-blue-800 dark:text-ucr-blue-200">
                    {% if listing.min_bathrooms == listing.max_bathrooms %}
                        {{ listing.min_bathrooms }} {% if listing.min_bathrooms == 1 %}Bathroom{% else %}Bathrooms{% endif %}
                    {% else %}
                        {{ listing.min_bathrooms }}-{{ listing.max_bathrooms }} Bathrooms
                    {% endif %}
                </div>
            {% else %}
                <!-- Single unit property details -->
                <div class="bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full">
                    <span class="font-medium">{{ listing.bedrooms }}</span> {% if listing.bedrooms == 1 %}Bedroom{% else %}Bedrooms{% endif %}
                </div>
                <div class="bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full">
                    <span class="font-medium">{{ listing.bathrooms }}</span> {% if listing.bathrooms == 1 %}Bathroom{% else %}Bathrooms{% endif %}
                </div>
            {% endif %}
            
            {% if listing.square_feet %}
            <div class="bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full">
                <span class="font-medium">{{ listing.square_feet }}</span> sq ft
            </div>
            {% endif %}
            <div class="bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full capitalize">
                {{ listing.property_type }}
            </div>
            {% if listing.available_date %}
            <div class="bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full">
                Available: {{ listing.available_date.strftime('%b %d, %Y') }}
            </div>
            {% endif %}
        </div>
        
        <!-- Description -->
        <div class="mb-6">
            <h2 class="text-lg font-semibold mb-2 dark:text-white">Description</h2>
            <div class="text-gray-700 dark:text-gray-300 space-y-2">
                {% for paragraph in listing.description.split('\n') %}
                    <p>{{ paragraph }}</p>
                {% endfor %}
            </div>
        </div>
        
        <!-- Unit Options for Multi-unit Properties -->
        {% if listing.is_multi_unit and listing.unit_options_list %}
        <div class="mb-6">
            <h2 class="text-lg font-semibold mb-3 dark:text-white">Available Floor Plans</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                {% for option in listing.unit_options_list %}
                <div class="unit-option bg-ucr-blue-50 dark:bg-ucr-blue-900/30 border border-ucr-blue-100 dark:border-ucr-blue-800 rounded-lg p-3">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="font-semibold text-ucr-blue-800 dark:text-ucr-blue-200">{{ option.name }}</h3>
                        <span class="font-bold text-ucr-blue-600 dark:text-ucr-blue-400">${{ "%.2f"|format(option.price) }}</span>
                    </div>
                    <div class="flex flex-wrap gap-2 text-sm">
                        <span class="bg-white dark:bg-gray-800 px-2 py-0.5 rounded-md text-ucr-blue-700 dark:text-ucr-blue-300">
                            {{ option.bedrooms }} {% if option.bedrooms == 1 %}Bed{% else %}Beds{% endif %}
                        </span>
                        <span class="bg-white dark:bg-gray-800 px-2 py-0.5 rounded-md text-ucr-blue-700 dark:text-ucr-blue-300">
                            {{ option.bathrooms }} {% if option.bathrooms == 1 %}Bath{% else %}Baths{% endif %}
                        </span>
                        {% if option.square_feet %}
                        <span class="bg-white dark:bg-gray-800 px-2 py-0.5 rounded-md text-ucr-blue-700 dark:text-ucr-blue-300">
                            {{ option.square_feet }} sq ft
                        </span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <!-- Amenities -->
        {% if listing.amenities %}
        <div class="mb-6">
            <h2 class="text-lg font-semibold mb-2 dark:text-white">Amenities</h2>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                {% for amenity in listing.amenities %}
                <div class="flex items-center">
                    <svg class="h-5 w-5 text-ucr-blue-500 dark:text-ucr-blue-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    <span class="ml-2">{{ amenity.name }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <!-- Contact Information -->
        <div class="mb-6">
            <h2 class="text-lg font-semibold mb-2 dark:text-white">Contact Information</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Email</p>
                    <p class="font-medium dark:text-white">{{ listing.contact_email }}</p>
                </div>
                {% if listing.contact_phone %}
                <div>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Phone</p>
                    <p class="font-medium dark:text-white">{{ listing.contact_phone }}</p>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Edit and Delete Buttons -->
        <div class="flex justify-end space-x-4 mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
            <a href="{{ url_for('listing.edit', listing_id=listing.id) }}" class="btn-outline">
                <svg class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
                Edit Listing
            </a>
            <button 
                onclick="if(confirm('Are you sure you want to delete this listing? This cannot be undone.')) { document.getElementById('delete-form').submit(); }" 
                class="btn bg-red-600 text-white hover:bg-red-700 focus:ring-red-500">
                <svg class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
                Delete
            </button>
            <form id="delete-form" action="{{ url_for('listing.delete', listing_id=listing.id) }}" method="POST" class="hidden"></form>
        </div>
    </div>
    
    <!-- Map and Additional Info -->
    <div class="lg:col-span-1 space-y-6">
        <!-- Map Container -->
        <div id="detail-map" class="h-64 rounded-lg shadow-md" 
             data-lat="{{ listing.latitude }}" 
             data-lng="{{ listing.longitude }}"
             data-title="{{ listing.title }}"></div>
        
        <!-- Posted Date -->
        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md">
            <p class="text-sm text-gray-500 dark:text-gray-400">Posted on</p>
            <p class="font-medium dark:text-white">{{ listing.created_at.strftime('%B %d, %Y') }}</p>
            {% if listing.created_at != listing.updated_at %}
            <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Updated on</p>
            <p class="font-medium dark:text-white">{{ listing.updated_at.strftime('%B %d, %Y') }}</p>
            {% endif %}
        </div>
        
        <!-- Similar Listings (placeholder) -->
        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md">
            <h3 class="text-lg font-semibold mb-2 dark:text-white">Similar Listings</h3>
            <p class="text-gray-500 dark:text-gray-400 text-sm">Coming soon...</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize the map
        const detailMap = document.getElementById('detail-map');
        const lat = parseFloat(detailMap.getAttribute('data-lat')) || 33.9737;
        const lng = parseFloat(detailMap.getAttribute('data-lng')) || -117.3281;
        const title = detailMap.getAttribute('data-title');
        
        const map = L.map('detail-map').setView([lat, lng], 15);
        
        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        
        // Add a marker for the listing
        L.marker([lat, lng])
            .addTo(map)
            .bindPopup(`<strong>${title}</strong><br>${"$" + {{ listing.price }}.toFixed(2)}`);
    });
</script>
{% endblock %} 